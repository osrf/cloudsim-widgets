<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../elements/elements.html">

<dom-module id="cs-srcregister">
  <style>
    :host {
      text-align: center;
    }
    .title {
      font-size: 2em;
    }
    .blue {
      background-color: rgb(68, 138, 201);
      color: #fff;
    }
    .paper-header {
      padding: 1em;
    }
    .paper-header > h1 {
      text-align: center;
    }
  </style>
  <template>

    <!-- TODO: this could be inside if loggedin, but then we can't use this.$.resources -->
    <gz-resources
      id="resources"
      url="[[baseUrl]]"
      token="[[token]]"
      resourcename="srcsignup"
      data="[[data]]"
      on-created="_onRequested"
      on-resourcesupdated="_onResources"
    ></gz-resources>

    <paper-header-panel class="blue">
      <div class="paper-header">
        <h1 class="title">Register for the Secret Robotics Competition!</h1>
      </div>
    </paper-header-panel>

    <template is="dom-if" if="[[loggedin]]">

      <!-- NEW USERS -->
      <template is="dom-if" if="[[new]]">
        <h1>
          Click the following button if you'd like to participate in the competition.
          You'll receive an email once your participation was accepted.
        </h1>
        <paper-button raised on-click="_tapRequest">
          Request!
        </paper-button>
      </template>

      <!-- WAITING ON APPROVAL -->
      <template is="dom-if" if="[[waiting]]">
        <h1>
          You've requested to participate in this competition.
          Waiting on approval by administrators.
        </h1>
      </template>

      <!-- ALREADY IN COMPETITION -->
      <template is="dom-if" if="[[competitor]]">
        <h1>
          You're already a participant. Go to the <a href="[[baseUrl]]srckiosk">competition kiosk</a>.
        </h1>
      </template>

    </template>

    <template is="dom-if" if="[[!loggedin]]">
      <h1>
        You must have a CloudSim account to participate in the competition.
        Please login or signup above.
      </h1>
    </template>

  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'cs-srcregister',
      // Attached
      attached: function() {
        let that = this;
        window.addEventListener('WebComponentsReady', function() {
          if (that.token === "") {
            console.error("cs-srcregister: No token");
          }
          else {
            that.$.resources.getAll();
          }
        });
        console.log('cs-srcregister widget attached!')
      },

      /// Callback when request button is pressed
      _tapRequest: function() {
        this.$.resources.create();
        this.fire('notification', "Sending request to participate in SRC.")
      },

      /// Callback when successfully requested
      _onRequested: function() {
        this.fire('notification', "Successfully requested to participate in SRC.")
      },

      /// Callback when the list of resources had been updated
      _onResources: function() {
        if (!this.data.resources) {
          this.new = true;
          this.waiting = false;
          this.waiting = false;
        }

console.log(this.data)
      },

      properties: {
        /// True if user is logged in
        loggedin: {
          type: Boolean,
          value: false,
          notify: true
        },

        /// True if user is new to the competition (never requested to participate)
        new: {
          type: Boolean,
          value: false,
          notify: true
        },

        /// True if user's approval to participate is pending.
        waiting: {
          type: Boolean,
          value: false,
          notify: true
        },

        /// True if user is already a competitor.
        competitor: {
          type: Boolean,
          value: false,
          notify: true
        },

        /// Name of current user
        currentuser: {
          type: String,
          value: "not set",
          notify: true
        },

        /// Data for registration
        data: {
          type: Object,
          value: {},
          notify: true
        },
      },
    });
  })();
  </script>
</dom-module>
