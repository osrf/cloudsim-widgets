<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../elements/elements.html">

<dom-module id="cs-dashboard">
  <style>
      :host {
        display: block;
        padding-top: 3em;
        @apply(--paper-font-common-base);
      }
      .horizontal {
        @apply(--layout-horizontal);
        @apply(--layout-center);
      }
      #launchArea {
        margin: auto;
        width: 30%;
      }
      #adminArea {
        margin: auto;
      }
  </style>
  <template>

    <div class="horizontal">
      <div id="adminArea">
        <cs-serverstatus></cs-serverstatus>
      </div>

      <div id="launchArea">
        <cs-machinelauncher
          portalUrl={{portalurl}}
          token={{token}}
        ></cs-machinelauncher>
      </div>
    </div>

    <cs-machinelist
      id="machinelist"
      portalurl="{{portalurl}}"
    ></cs-machinelist>

  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'cs-dashboard',
      // Attached
      attached: function() {
        // TODO: separate launch and admin logic
        this.$.launchArea.style.display = (this.canLaunch == 'true' ? '' : 'none');
        this.$.adminArea.style.display = (this.canLaunch == 'true' ? '' : 'none');

        // Listen to events
        var that = this;
        window.addEventListener('login', function(e) {
          that.token = e.detail.token;

          // FIXME: hardcoded admin can launch machines
          that.canLaunch = (e.detail.user === "admin" ? 'true' : 'false')

          that.refresh()
        });

        window.addEventListener('logout', function(e) {
          that.token = "";
        });

        console.log('cs-dashboard widget attached!')
      },
      refresh() {
        this.$.machinelist.refresh();
        this.$.launchArea.style.display = (this.canLaunch == 'true' ? '' : 'none');
        this.$.adminArea.style.display = (this.canLaunch == 'true' ? '' : 'none');
      },
      properties: {
        portalurl: {
          type: String,
          value: 'https://localhost:4000',
          notify: true
        },
        token: {
          type: String,
          value: 'placeholder',
          notify: true
        },
        canLaunch: {
          type: String,
          value: 'false',
          notify: true
        },
      },
    });
  })();
  </script>
</dom-module>
