<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../elements/elements.html">

<dom-module id="cs-signuppage">
  <template>

    <gz-accounts
      id="accounts"
      url={{url}}
      on-register="onRegister"
    ></gz-accounts>

    <!-- Look using a custom validator or paper-input-error -->
    <paper-input label="User name" id="user"></paper-input>
    <paper-input label="Password" id="pass1" type="password"></paper-input>
    <paper-input label="Confirm password" id="pass2" type="password"></paper-input>

    <paper-button raised on-click="tapRegisterUser">
      Create account
    </paper-button>

  </template>

  <script>

  (function() {
    'use strict';

    Polymer({
      is: 'cs-signuppage',
      attached: function() {
        console.log('cs-signuppage widget attached!')
      },

      tapRegisterUser: function() {
        // username can't be empty
        var user = this.$.user.value;
        var self = this;
        if (user === "")
        {
          this.fire('notification', {msg: "User name can't be empty.", type: "error"})
          return;
        }
        // verify passwords
        var pass = this.$.pass1.value;
        var pass2 = this.$.pass2.value;
        if (pass != pass2)
        {
          this.fire('notification', {msg: "Passwords don't match.", type: "error"})
          return;
        }
        if (pass === "")
        {
          this.fire('notification', {msg: "Password can't be empty.", type: "error"})
          return;
        }

        this.$.accounts.registerUser(user, pass);
      },
      onRegister: function(e) {
        let success = e.detail.success
        let username = e.detail.user
        let msg = e.detail.msg
        let type = success ? 'msg' : 'error'
        this.fire('notification', {msg: msg, type: type})
      },

      properties: {
        url: {
          type: String,
          value: 'https://localhost:5050',
          notify: true
        },
      }
    });
  })();
  </script>
</dom-module>
