<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../elements/elements.html">

<dom-module id="cs-serverstatus">
  <style>
    iron-icon {
      color: red;
      display: inline-block;
      vertical-align: middle;
    }
    :host([status]) iron-icon {
      color: green;
    }
  </style>

  <template>
    <iron-ajax
      id="ajax"
      method="HEAD"
      on-response="_ajaxResponse"
      on-error="_ajaxError"
      debounce-duration="300"
    ></iron-ajax>
    
    <a href="[[url]]" target="_blank">[[url]]</a>
    <iron-icon id="statusIron" icon="icons:clear"></iron-icon>

  </template>

  <script>

  (function() {
    'use strict';

    Polymer({
      is: 'cs-serverstatus',

      attached: function() {
        this.$.ajax.url = this.url;
        this.$.ajax.generateRequest();
        this._ajaxRequest();
      },

      // Make a request to the given URL. Interval is given in milliseconds.
      _ajaxRequest: function(interval) {
        // Default interval is 30 seconds.
        if (interval == undefined) {
          interval = 30000;
        }
        console.log(interval)
        this.async(function() {
          this.$.ajax.generateRequest();
        }, interval);
      },

      // Response to check the Server Status.
      _ajaxResponse: function(e) {
        this.$.statusIron.icon="icons:check"
        this.status = true
        this._ajaxRequest();
      },

      // Error reaching the Server.
      _ajaxError: function(e) {
        this.$.statusIron.icon="icons:clear"
        this.status = false
        this._ajaxRequest();
      },

      properties: {
        url: {
          type: String,
          value: 'Not set',
          notify: true
        },
        status: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true
        }
      },
    });
  })();
  </script>
</dom-module>
