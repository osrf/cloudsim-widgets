<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../elements/elements.html">

<dom-module id="cs-app">

  <template>
    <style>

      paper-drawer-panel {
        /* space for toolbar */
        margin-top: 64px;
        height: calc(100% - 64px);
      }

      /* Height of the scroll area */
      .content {
        overflow: auto;
        background-color: #f3f3f3;
      }

      paper-material {
        margin: 1em;
        padding: 1em;
      }

      #errorToast {
        --paper-toast-background-color: #e74747
      }
      #msgToast {
        --paper-toast-background-color: rgb(43, 137, 222)
      }
    </style>

    <paper-toast
      id="errorToast"
      class="fit-bottom"
      duration="0">
      <paper-button onclick="errorToast.toggle()" class="yellow-button">Got it!</paper-button>
    </paper-toast>

    <paper-toast
      id="msgToast"
      class="fit-bottom">
    </paper-toast>

    <!-- Main Toolbar -->
    <cs-toptoolbar id="toptoolbar" authurl="{{authenticationUrl}}"></cs-toptoolbar>

    <!-- Parent pages: secure / public -->
    <iron-pages attr-for-selected="data-route" selected="{{routeParent}}">

      <!-- Public routes -->
      <section data-route="signup">
        <cs-signuppage
          on-notification="openToast"
          id="signuppage"
          url="{{authenticationUrl}}">
        </cs-signuppage>
      </section>

      <section data-route="stayintouch">
        <cs-stayintouchpage></cs-stayintouchpage>
      </section>

      <section data-route="home" style="padding: 0em">
        <gz-home/>
      </section>

      <section data-route="portfolio">

        <paper-material elevation="1">
          Authentication server: <a href={{authenticationUrl}} target="_blank">{{authenticationUrl}}</a>
          <br>
          Portal server: <a href={{portalUrl}} target="_blank">{{portalUrl}}</a>
        </paper-material>

        <paper-material elevation="1">
          <gz-accounts
            id="portfolio-accounts"
            config
            url="{{authenticationUrl}}"
          ></gz-accounts>
        </paper-material>

        <paper-material elevation="1">
          <gz-token
            id="portfolio-token"
            config
            url="{{authenticationUrl}}"
        ></gz-token>
        </paper-material>

        <paper-material elevation="1">
          <gz-grant
            id="portfolio-grant"
            gui
            config
            url="{{simUrl}}"
          ></gz-grant>
        </paper-material>

        <paper-material elevation="1">
          <gz-simulatorLauncher
            id="portfolio-simulatorLauncher"
            config
            url="{{portalUrl}}"
          ></gz-simulatorLauncher>
        </paper-material>

        <paper-material elevation="1">
          <gz-simulatorq
            id="portfolio-simulatorq"
            gui
            config
            url="{{portalUrl}}"
          ></gz-simulatorq>
        </paper-material>

        <paper-material elevation="1">
          <gz-cmd
            id="portfolio-cmd"
            gui
            config
            url="{{simUrl}}"
          ></gz-cmd>
        </paper-material>

        <paper-material elevation="1">
          <gz-simulationlauncher
            id="portfolio-simulationlauncher"
            gui
            config
          ></gz-simulationlauncher>
        </paper-material>

        <paper-material elevation="1">
          <gz-simulationq
            id="portfolio-simulationq"
            gui
            config
          ></gz-simulationq>
        </paper-material>

      </section>

      <!-- Secure routes -->
      <section data-route="secure">

        <!-- Drawer / panel -->
        <paper-drawer-panel id="paperDrawerPanel">

          <!-- Main Menu -->
          <cs-menu id="menu" drawer fixed></cs-menu>

          <!-- Main Content -->
          <div class="content" main id="headerPanelMain">

            <iron-pages attr-for-selected="data-route" selected="{{route}}">

              <section data-route="dashboard">
                <cs-dashboard id="dashboard" portalurl="{{portalUrl}}"></cs-dashboard>
              </section>

              <section data-route="src">
                <cs-src id="src"
                  route="{{routeSrc}}"
                ></cs-src>
              </section>
            </iron-pages>
          </div>

        </paper-drawer-panel>

      </section> <!-- secure -->

    </iron-pages>

  </template>

  <script>

    Polymer({

      is: 'cs-app',

      attached: function() {

        // Get configuration from environment variables
        this.authenticationUrl = getConfig().auth
        this.portalUrl = getConfig().portal
        this.simUrl = getConfig().simu

        // Sets app default base URL
        this.baseUrl = '/';

        this.addEventListener('login', function(e) {
          this.loggedin = true

          // Open dashboard unless we're using the portfolio
          if (window.location.pathname != '/portfolio')
          {
            this.routeParent = "secure"
            this.route = "dashboard"
          }
        });

        this.addEventListener('logout', function(e) {
          this.loggedin = false
          this.routeParent = "home"
        });

        this.addEventListener('notification', function(e) {
          this.openToast(e);
        });

        console.log('cs-app widget [' + this.title + '] attached!')
      },
      openToast: function(e) {
        if (e.detail.type === "error")
        {
          this.$.errorToast.text = e.detail.msg
          this.$.errorToast.open()
        }
        else
        {
          this.$.msgToast.text = e.detail.msg
          this.$.msgToast.open()
        }
      },
      properties: {
        authenticationUrl: {
          type: String,
          value: 'https://localhost:5050',
          notify: true
        },
        portalUrl: {
          type: String,
          value: 'https://localhost:4000',
          notify: true
        },
        simUrl: {
          type: String,
          value: 'https://localhost:8080',
          notify: true
        },
        loggedin: {
          type: Boolean,
          value: false,
          notify: true
        },
      }
    });

  </script>

</dom-module>

