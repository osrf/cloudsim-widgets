<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../elements/elements.html">

<dom-module id="cs-machinekillbutton">
  <style>
      .miniButton {
        font-size: 0.8em;
        width: 7em;
      }
      .killButton > iron-icon {
        --iron-icon-fill-color: #f00;
      }
  </style>
  <template>

    <!-- For launching new machines-->
    <gz-simulatorlauncher
      id="simulatorlauncher"
      url={{portalurl}}
      token={{token}}
      on-killed="onKilled"
      on-error="onError"
    ></gz-simulatorlauncher>

    <paper-button raised class="killButton miniButton" on-tap="tapKill">
      <iron-icon icon="icons:close"></iron-icon>
      Kill
    </paper-button>

  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'cs-machinekillbutton',
      attached: function() {
        console.log('cs-machinekillbutton widget attached!')
      },
      tapKill(e) {
        // Send request to gz-simulatorlauncher
        this.fire('notification',
            {msg: "Request to kill machine has been sent.", type: "msg"})
        this.$.simulatorlauncher.killMachine(this.machine_id);
      },
      onKilled: function(e) {
        this.fire('notification',
            {msg: "Machine has been killed.", type: "msg"})
      },
      onError: function(e) {
        console.log(e)
      },
      properties: {
        portalurl: {
          type: String,
          value: 'https://localhost:4000',
          notify: true
        },
        token: {
          type: String,
          value: 'placeholder',
          notify: true
        },
        machine_id: {
          type: String,
          value: 'placeholder',
          notify: true
        },
      },
    });
  })();
  </script>
</dom-module>
